<html>
	<head>
		<title>Cuộc Chiến Lãnh Thổ</title>
		<script src="jquery.js"></script>
 		<script type="text/javascript" src="datatables.js"></script>
		<script src="http://localhost:3000/socket.io/socket.io.js"></script>
		<script>
			var socket = io.connect("http://localhost:3000",{query:"team=display"});
			// Bắt đầu trận mới
			$(function(){
				$("#start_Game").click(function(){
					socket.emit("start_Game");
				});
				$("#restart").click(function(){
					socket.emit("restart");
				});
				$("#disconnectX").click(function(){
					socket.emit("disconnected",{"team": "X" });
					$("#memberX > tbody").empty();
					$("#disX").html("Đang kết nối");
				});
				$("#disconnectO").click(function(){
					socket.emit("disconnected",{"team": "O" });
					$("#disO").html("Đang kết nối");
					$("#memberO > tbody").empty();
				});
			});
			// Kết nối socket
			socket.on("connect", function() {
	      		alert("Kết nối thành công!" );
	  		});
			socket.on("connected",function(data){
				let team = data.team;
				if (team=="X"){
					$("#disX").html("Ngăt kết nối");
				}else if (team =="O") {
					$("#disO").html("Ngăt kết nối");
				}
			});
			//countdown
			socket.on("countDown", function(data){
				let turn = data.turn;
				let time = data.countTime;
				if(turn=="X"){
					$('#timeX').html("Time (ms): "+time*100);
					document.getElementById('timeX').style.setProperty('border','5px solid green');
					document.getElementById('timeO').style.setProperty('border','5px solid white');
				}else if(turn=="O"){
					$('#timeO').html("Time (ms): "+time*100);
					document.getElementById('timeO').style.setProperty('border','5px solid green');
					document.getElementById('timeX').style.setProperty('border','5px solid white');
				}
			});
	  		// Cập nhật tỉ số
		  	socket.on("score", function(data){
		  		let message = "Tỉ số: "+data.X+" - "+data.O;
			  	$("#score").html(message);
		  	});
		  	// Game over
		  	socket.on("game_Over", function(data){
		  		let round = data.round;
		  		let team = data.result;
		  		alert("Team "+team+" thua tran "+round);
		  	});
		  	//time out
		  	socket.on("time_Out", function(data){
		  		let team =data.team;
		  		alert("Team "+team+" time out!!!");
		  	})

		  	socket.on("end_Game", function(data){
		  		alert("Team "+data.team+" da thang chung cuoc");
		  	});
		  	// Cap nhat nuoc di moi
		  	socket.on("displayPoint",  function(data){
		  		let team = data.type;
		  		let x = data.x;
		  		let y = data.y;
		  		let table = document.getElementById('map_fighting');
		  		if (team == "X"){
		  			$("#timeX").html("Time (ms): 1000");
		  			table.rows[x].cells[y].innerHTML = '<img src="image/robot.png" height="49px" width="49px"></img>';
		  		}else{
		  			$("#timeO").html("Time (ms): 1000");
					table.rows[x].cells[y].innerHTML = '<img src="image/robot2.png" height="49px" width="49px"></img>';
		  		}

		  	});

		  	// Cập nhật  số trận trận
		  	socket.on("round",function(data){
		  		let message = "Tran: "+data.round;
		  		$("#round").html(message);
		  	});
		  	// Lấy map mới
		  	socket.on("new_Map", function(data){
		  		$("#timeO").html("Time (ms): 1000");
		  		$("#timeX").html("Time (ms): 1000");
		  		$("#map_fighting").empty();
		  		let table = document.getElementById('map_fighting');
		  		var row, cell1;
		  		let file = new Array("image/ooo.png","image/robot.png","image/robot2.png","image/matran.png"  );

		  		for (let i = 0; i < data.ncol; i++) {
		  			row = table.insertRow(i);
		  			for (var j = 0; j < data.ncol; j++) {
					  	cell1 = row.insertCell(j);
					  	cell1.innerHTML = '<img src="'+file[data.map[i][j]]+'" height="49px" width="49px"></img>';
		  			}
		  		}
		  	});
		  	// Lấy thông tin đội
		  	socket.on("Infor", function(data){
		  		let team = data.team;
		  		let name = data.name;
		  		let members = data.members;
		  		if (team=="X"){
		  			$("#nameX").html("Đội: "+name);
		  			$("#memberX > tbody").empty();
		  			members.forEach(function(row){
		    			$("#memberX").append('<tr><td>'+row.name+'</td></tr>')
		    			// $("#memberX").append('<tr><td>'+row.name+'</td><td>'+row.mssv+'</td><td>'+'K'+'</td></tr>')
		    		});
		  		}else{
		  			$("#nameO").html("Đội: "+name);
		  			$("#memberO > tbody").empty();
		  			members.forEach(function(row){
		  				$("#memberO").append('<tr><td>'+row.name+'</td></tr>')
		    			// $("#memberO").append('<tr><td>'+row.name+'</td><td>'+row.mssv+'</td><td>'+'K'+'</td></tr>')
		    		});
		  		}
		  	});
		</script>
	</head>

	<body>

		<div id="wrapper" style="width: 100%">
			<!-- <div id="name" style="	width: 100%; height: 50px; margin: auto;">
				<h1 align="center"> Cuộc chiến lãnh thổ </h1>
			</div> -->
			<!-- Button create new game, score and round -->
<!-- 			<div style="width: 70%; height: 75px; margin: auto;">
				<div style="width: 15%; float: left" >
					<h2 id="score" align="center">Tỉ số: 0 - 0</h2>
				</div>
				<div style="width: 15%; float: left" >
					<h2 id="round" align="left">Round: 1</h2>
				</div>

				<div style="width: 30%; float: left">
					<h2 align="center"> Cuộc chiến lãnh thổ </h2>
				</div>

				<div style="width: 20%; float: left" align="center">
					<button id="start_Game" name="Bắt Đầu" type="button" style="background:#fff; width: 150; height: 50px ;">
						<font size = 4 style='color:blue'><b>Bắt Đầu</b></font>
					</button>
				</div>

				<div style="width: 20%; float: left" align="center">
					<button id="restart" type="button" style="background:#fff; width: 150; height: 50px ;">
						<font size = 4 style='color:blue'><b>Tao tran</b></font>
					</button>
				</div>
			</div> -->


			<!-- Đội X -->
			<div  style="	width: 18%; height: 750px;  float: left;">
				<div style="height: 500; border: 5px solid green;">
					<div style="height: 30px; ">
						<h3 id=nameX align="center"> ABC </h3>
					</div>
					<div style="height: 250px">
						<h3 align="center"> Thành viên </h3>
						<table id="memberX" border="1">
							<thead>
								<tr id=header>
									<th scope="col" width="19%">Họ và Tên</th>
	<!-- 								<th scope="col" width="12%">Họ và Tên</th>
									<th scope="col" width="4%">MSSV</th>
									<th scope="col" width="4%">Lớp</th> -->
								</tr>
							</thead>
							<tbody>

							</tbody>
						</table>
					</div>

					<div style="height: 40px">
						<div style="width: 15%; height: 40px; float: left;"></div>
						<h2 id="timeX"  style=" width: 75% height: 40px; border: 5px solid white; float: left;" align="center">Time (ms): 1000</h2>
						<div style="width: 10%; height: 40px;float: left;"></div>
					</div>

					<div align="center" style="height: 60px">
						<button id="disconnectX" name="disconnect" type="button" style="background:#fff; width: 150; height: 50px ;"  align="center">
							<font size = 4 style='color:blue'><b id="disX">Đang kết nối</b></font>
						</button>
					</div>
				</div>
				<div style="height: 240; border: 5px solid blue">
					<div style="height: 30px"></div>
					<div style="height: 70px" align="center">
						<button id="start_Game" name="Bắt Đầu" type="button" style="background:#fff; width: 150; height: 50px ;">
							<font size = 4 style='color:blue'><b>Bắt Đầu</b></font>
						</button>
					</div>

					<div style="height: 70px" align="center">
						<button id="restart" type="button" style="background:#fff; width: 150; height: 50px ;">
							<font size = 4 style='color:blue'><b>Tao tran</b></font>
						</button>
					</div>
				</div>
			</div>

			<!-- Map thi đấu -->
			<div id="map" style=" width: 60%; height: 750px; border: 5px solid gray; float: left;">
					<table id="map_fighting" align="center">
						<thead></thead>
						<tbody></tbody>
					</table>
			</div>

			<!-- Đội O -->
			<div  style="	width: 18%; height: 750px; float: left;">
				<div style="height: 240; border: 5px solid blue">
					<div style="height: 50px">
						<h2 align="center"> Cuộc chiến lãnh thổ </h2>
					</div>
					<div style="height: 50px" >
						<h2 id="score" align="center">Tỉ số: 0 - 0</h2>
					</div>
					<div style="height: 50px" >
						<h2 id="round" align="center">Tran: 1</h2>
					</div>
				</div>
				<div style="height: 500px; border: 5px solid red">
					<div style="height: 40px">
						<div style="width: 15%; height: 40px; float: left;"></div>
						<h2 id="timeO"  style=" width: 75% height: 40px; border: 5px solid white; float: left;" align="center">Time (ms): 1000</h2>
						<div style="width: 10%; height: 40px;float: left;"></div>
					</div>

					<div align="center" style="height: 75px">
						<button id="disconnectO" name="disconnect" type="button" style="background:#fff; width: 150; height: 50px ;">
							<font size = 4 style='color:blue'><b id="disO">Đang kết nối</b></font>
						</button>
					</div>

					<div style="height: 30px; ">
						<h3 id=nameO align="center"> ABC </h3>
					</div>
					<div style="height: 250px">
						<h3 align="center"> Thành viên </h3>
						<table id="memberO" border="1">
							<thead>
								<tr id=header>
									<th scope="col" width="19%">Họ và Tên</th>
	<!-- 								<th scope="col" width="12%">Họ và Tên</th>
									<th scope="col" width="4%">MSSV</th>
									<th scope="col" width="4%">Lớp</th> -->
								</tr>
							</thead>
							<tbody>

							</tbody>
						</table>
					</div>

				</div>
			</div>



		</div>
	</body>	
</html>